{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/dNFTs/","result":{"data":{"markdownRemark":{"id":"2f8064aa-4969-5fa4-8490-b884c1c78369","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db07b7ab69787430d7121fc12a022fef/cd902/dynamic.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHFakTIXh//xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIEEhP/2gAIAQEAAQUCVZpzrs4TNM0zZ//EABURAQEAAAAAAAAAAAAAAAAAAAAS/9oACAEDAQE/AZS//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Bqv/EABoQAAICAwAAAAAAAAAAAAAAAAAxAhARIUH/2gAIAQEABj8CcTWBCrp//8QAGhAAAwADAQAAAAAAAAAAAAAAAAERITFBUf/aAAgBAQABPyG8oX5s/Bd0K8FHoWGh/9oADAMBAAIAAwAAABDUH//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ELP/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPxCUP//EABoQAQADAQEBAAAAAAAAAAAAAAEAESFhMYH/2gAIAQEAAT8QBDlWbvpqNMAUL6Q0IV2eOMbdhIu7iT//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/db07b7ab69787430d7121fc12a022fef/01472/dynamic.webp 240w,\n/static/db07b7ab69787430d7121fc12a022fef/222bd/dynamic.webp 480w,\n/static/db07b7ab69787430d7121fc12a022fef/620b9/dynamic.webp 960w,\n/static/db07b7ab69787430d7121fc12a022fef/28063/dynamic.webp 1440w,\n/static/db07b7ab69787430d7121fc12a022fef/34ef4/dynamic.webp 1920w,\n/static/db07b7ab69787430d7121fc12a022fef/f3ee0/dynamic.webp 3968w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/db07b7ab69787430d7121fc12a022fef/3bc27/dynamic.jpg 240w,\n/static/db07b7ab69787430d7121fc12a022fef/98431/dynamic.jpg 480w,\n/static/db07b7ab69787430d7121fc12a022fef/b3ee8/dynamic.jpg 960w,\n/static/db07b7ab69787430d7121fc12a022fef/b97fe/dynamic.jpg 1440w,\n/static/db07b7ab69787430d7121fc12a022fef/fb329/dynamic.jpg 1920w,\n/static/db07b7ab69787430d7121fc12a022fef/cd902/dynamic.jpg 3968w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/db07b7ab69787430d7121fc12a022fef/b3ee8/dynamic.jpg\"\n          alt=\"ocean-rio\"\n          title=\"ocean-rio\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Dynamic NFTs are tokens whose metadata is not fixed, but can change over time; depending on on-chain or external conditions. Multiple use cases can be accomplished. It allows us to represent objects in an evolving matter; particularly useful for gaming, nesting, and modeling real-world assets. For a while it has been a thing hard to accomplish; one common pattern is using oracles to update the metadata, but one has to trust the oracle, and tends to be a less decentralized, and not on-chain solution. Alternatively, on-chain data can be used, but is either limiting or simple, such as block and transaction properties (block.number, block.prevrandao), and tracking complex relationships can be cumbersome and complex.</p>\n<p>Recently with the introduction of EIP-6551, we have an easier way to model dynamic NFTs based on their token-bound account (TBA) state. Meaning we can allow the NFT to be aware of its TBA state, and have that reflected on its metadata. As an example we constructed a dNFT that changes color based on a specific ERC20 balance MANA. It is completely on chain metadata, built using SVG and Base64.encode JSON object from solidity as the returned output of the tokenURI method.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">function</span> <span class=\"token function\">tokenURI</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">uint256 tokenId</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">public</span>\n        view\n        <span class=\"token function\">override</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ERC721</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">string memory</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        uint256 tokenBalance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTokenManaBalance</span><span class=\"token punctuation\">(</span>tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        string memory tokenBalanceAsString <span class=\"token operator\">=</span> <span class=\"token function\">_toString</span><span class=\"token punctuation\">(</span>tokenBalance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        string<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> memory parts<span class=\"token punctuation\">;</span>\n        parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;svg ...  fill=\"#'</span><span class=\"token punctuation\">;</span>\n        parts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">_getColor</span><span class=\"token punctuation\">(</span>tokenBalance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        parts<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'\"/>&lt;text x=\"10\" y=\"20\" class=\"base\">Balance: '</span><span class=\"token punctuation\">;</span>\n        parts<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tokenBalanceAsString<span class=\"token punctuation\">;</span>\n        parts<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;/text>&lt;/svg>'</span><span class=\"token punctuation\">;</span>\n\n        string memory output <span class=\"token operator\">=</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>abi<span class=\"token punctuation\">.</span><span class=\"token function\">encodePacked</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> parts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> parts<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> parts<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> parts<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        string memory json <span class=\"token operator\">=</span> Base64<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">bytes</span><span class=\"token punctuation\">(</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span>abi<span class=\"token punctuation\">.</span><span class=\"token function\">encodePacked</span><span class=\"token punctuation\">(</span><span class=\"token string\">'{\"name\": \"Dynamic NFT#'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">_toString</span><span class=\"token punctuation\">(</span>tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\", \"balance\": \"'</span><span class=\"token punctuation\">,</span> tokenBalanceAsString<span class=\"token punctuation\">,</span> <span class=\"token string\">'\", \"description\": \"\", \"image\": \"data:image/svg+xml;base64,'</span><span class=\"token punctuation\">,</span> Base64<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">bytes</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\"}'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        output <span class=\"token operator\">=</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>abi<span class=\"token punctuation\">.</span><span class=\"token function\">encodePacked</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data:application/json;base64,'</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> output<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Overall the above code is well understood and it is used in many NFTs whose intention is to show their compromise with decentralization; since every part of the NFT depends on on-chain elements, a good example being rLOOT. The interesting part lies in this method call.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">uint256 tokenBalance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTokenManaBalance</span><span class=\"token punctuation\">(</span>tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is actually what is making our contract aware ofitselff. Different colors will be expressed, based on the balance the NFT holds in its TBA. This is just one simple example, but one gets an idea of how things could scale easily.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getTokenManaBalance</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">uint256 tokenId</span><span class=\"token punctuation\">)</span> \n  external\n  view\n  <span class=\"token function\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">uint256</span><span class=\"token punctuation\">)</span>    \n<span class=\"token punctuation\">{</span>\n  address tokenBoundAccount <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAccount</span><span class=\"token punctuation\">(</span>tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  uint256 tokenBalance <span class=\"token operator\">=</span> <span class=\"token function\">ManaToken</span><span class=\"token punctuation\">(</span>manaTokenAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span>tokenBoundAccount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> tokenBalance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Full code can be found <a href=\"https://github.com/scammi/DynamicNFT/blob/main/src/DynamicDataNft.sol\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>","fields":{"slug":"/posts/dNFTs/","tagSlugs":["/tag/technology/","/tag/crypto/","/tag/english/"]},"frontmatter":{"date":"2023-08-30T23:46:37.121Z","description":"Example of responsive NFTs based on their TBA state. Expanding whats possible with digital assets.","tags":["Technology","Crypto","English"],"title":"dNFTs","socialImage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/dNFTs/"}}}